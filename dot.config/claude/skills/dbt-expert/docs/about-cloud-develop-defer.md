---
title: "Using defer in dbt | dbt Developer Hub"
source_url: "https://docs.getdbt.com/docs/cloud/about-cloud-develop-defer"
fetched_at: "2025-12-16T14:20:18.809572+00:00"
---



* * [Develop with dbt](https://docs.getdbt.com/docs/cloud/about-develop-dbt)* Defer in dbt

Copy page

Copy page

Copy page as Markdown for LLMs

[Open in ChatGPT

Ask questions about this page](https://chatgpt.com/?hints=search&prompt=Read+from+https%3A%2F%2Fdocs.getdbt.com%2Fdocs%2Fcloud%2Fabout-cloud-develop-defer+so+I+can+ask+questions+about+it.)[Open in Claude

Ask questions about this page](https://claude.ai/new?q=Read+from+https%3A%2F%2Fdocs.getdbt.com%2Fdocs%2Fcloud%2Fabout-cloud-develop-defer+so+I+can+ask+questions+about+it.)[Open in Perplexity

Ask questions about this page](https://www.perplexity.ai/search/new?q=Read+from+https%3A%2F%2Fdocs.getdbt.com%2Fdocs%2Fcloud%2Fabout-cloud-develop-defer+so+I+can+ask+questions+about+it.)

On this page

[Defer](https://docs.getdbt.com/reference/node-selection/defer) is a powerful feature that allows developers to only build and run and test models they've edited without having to first run and build all the models that come before them (upstream parents). dbt powers this by using a production manifest for comparison, and resolves the `{{ ref() }}` function with upstream production artifacts.

Both the Studio IDE and the dbt CLI enable users to natively defer to production metadata directly in their development workflows.

[![Use 'defer' to modify end-of-pipeline models by pointing to production models, instead of running everything upstream.](https://docs.getdbt.com/img/docs/reference/defer-diagram.png?v=2 "Use 'defer' to modify end-of-pipeline models by pointing to production models, instead of running everything upstream.")](#)Use 'defer' to modify end-of-pipeline models by pointing to production models, instead of running everything upstream.

When using `--defer`, dbt will follow this order of execution for resolving the `{{ ref() }}` functions.

1. If a development version of a deferred relation exists, dbt preferentially uses the development database location when resolving the reference.
2. If a development version doesn't exist, dbt uses the staging locations of parent relations based on metadata from the staging environment.
3. If no development version and no staging environment exist, dbt uses the production locations of parent relations based on metadata from the production environment. Note that dbt only defers to one environment per invocation — either staging or production.

**Note:** Passing the `--favor-state` flag will always resolve refs using staging metadata if available; otherwise, it defaults to production metadata regardless of the presence of a development relation, skipping step #1.

For a clean slate, it's a good practice to drop the development schema at the start and end of your development cycle.

If you require additional controls over production data, create a [Staging environment](https://docs.getdbt.com/docs/deploy/deploy-environments#staging-environment) and dbt will use that, rather than the Production environment, to resolve `{{ ref() }}` functions.

## Required setup[​](#required-setup "Direct link to Required setup")

* You must select the **[Production environment](https://docs.getdbt.com/docs/deploy/deploy-environments#set-as-production-environment)** checkbox in the **Environment Settings** page.
  + This can be set for one deployment environment per dbt project.
* You must have a successful job run first.

When using defer, it compares artifacts from the most recent successful production job, excluding CI jobs.

### Defer in the dbt IDE[​](#defer-in-the-dbt-ide "Direct link to Defer in the dbt IDE")

To use deferral in the Studio IDE, you must have production artifacts generated by a deploy job. dbt will first check for these artifacts in your Staging environment (if available), or else in the Production environment.

The defer feature in the Studio IDE won't work if a Staging environment exists but no deploy job has run. This is because the necessary metadata to power defer won't exist until a deploy job has run successfully in the Staging environment.

To enable defer in the Studio IDE, toggle the **Defer to staging/production** button on the command bar. Once enabled, dbt will:

1. Pull down the most recent manifest from the Staging or Production environment for comparison
2. Pass the `--defer` flag to the command (for any command that accepts the flag)

For example, if you were to start developing on a new branch with [nothing in your development schema](https://docs.getdbt.com/reference/node-selection/defer#usage), edit a single model, and run `dbt build -s state:modified` — only the edited model would run. Any `{{ ref() }}` functions will point to the staging or production location of the referenced models.

[![Select the 'Defer to production' toggle on the bottom right of the command bar to enable defer in the Studio IDE.](https://docs.getdbt.com/img/docs/dbt-cloud/defer-toggle.png?v=2 "Select the 'Defer to production' toggle on the bottom right of the command bar to enable defer in the Studio IDE.")](#)Select the 'Defer to production' toggle on the bottom right of the command bar to enable defer in the Studio IDE.

### Defer in dbt CLI[​](#defer-in-dbt-cli "Direct link to Defer in dbt CLI")

One key difference between using `--defer` in the Cloud CLI and the Studio IDE is that `--defer` is *automatically* enabled in the Cloud CLI for all invocations, compared with production artifacts. You can disable it with the `--no-defer` flag.

The Cloud CLI offers additional flexibility by letting you choose the source environment for deferral artifacts. You can manually set a `defer-env-id` key in either your `dbt_project.yml` or `dbt_cloud.yml` file. By default, the Cloud CLI will prefer metadata from the project's "Staging" environment (if defined), otherwise "Production."

dbt\_cloud.yml

```
context:
  active-host: ...
  active-project: ...
  defer-env-id: '123456'
```

dbt\_project.yml

```
dbt-cloud:
  defer-env-id: '123456'
```

## Was this page helpful?

YesNo

[Privacy policy](https://www.getdbt.com/cloud/privacy-policy)[Create a GitHub issue](https://github.com/dbt-labs/docs.getdbt.com/issues)

This site is protected by reCAPTCHA and the Google [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms) apply.

0

[Previous

About dbt LSP](https://docs.getdbt.com/docs/about-dbt-lsp)[Next

dbt VS Code extension](https://docs.getdbt.com/docs/about-dbt-extension)

* [Required setup](#required-setup)
  + [Defer in the dbt IDE](#defer-in-the-dbt-ide)+ [Defer in dbt CLI](#defer-in-dbt-cli)

[Edit this page](https://github.com/dbt-labs/docs.getdbt.com/edit/current/website/docs/docs/cloud/about-cloud-develop-defer.md)
