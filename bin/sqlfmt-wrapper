#!/bin/bash
# SQLフォーマッター用ラッパースクリプト
# uvプロジェクトの場合はuv run sqlfmtを、それ以外は直接sqlfmtを実行

set -euo pipefail

# プロジェクトルートを探す（.gitディレクトリまたは現在のディレクトリ）
PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)

# uv.lockファイルが存在するかチェック
if [ -f "$PROJECT_ROOT/uv.lock" ]; then
    # uvプロジェクトの場合
    cd "$PROJECT_ROOT" && uv run sqlfmt -
elif command -v sqlfmt >/dev/null 2>&1; then
    # 通常のプロジェクトの場合（sqlfmtがインストールされている）
    sqlfmt -
else
    # sqlfmtが見つからない場合はエラーメッセージ
    echo "Error: sqlfmt not found. Please install it with 'pip install shandy-sqlfmt[jinjasql]'" >&2
    exit 1
fi
