# Postman Configuration
# File-based communication daemon for tmux panes

[postman]
a2a_version = "1.0"
base_dir = ".postman"  # Directory structure: {base_dir}/{context_id}/post/, inbox/, etc.
entry = "concierge"
startup_delay_seconds = 10
reminder_interval = 5  # Send reminder after 5 messages (0 = disabled)
message_header = """
ðŸ“¬ Message from {from_node}
Inbox: .postman/inbox/{node}/
"""
message_footer = """
---
After processing, move from inbox/ to read/
"""

# Reply instruction (used in notifications and pings)
reply_command = "uv run ~/ghq/github.com/i9wa4/dotfiles/bin/postman.py create-draft --to <recipient>"

# Ping message template
ping_template = """
ðŸ“¬ [PING] Status check

contextId: {context_id}
You MUST reply with PONG to confirm you are active.

You are: {node}
{template}

{talks_to_line}

Active nodes: {active_nodes}

## A2A Methods

| method        | Usage                                |
| ------------- | ------------------------------------ |
| message/send  | Task request/response (A2A standard) |
| postman/ping  | Status check (postman extension)     |
| postman/pong  | Ping response (postman extension)    |

## Reply

NOTE: Do NOT use `uv run postman.py` (A2A_CONTEXT_ID is only set in postman shell).

Use direct file operations with contextId-based paths:
1. Create draft: `.postman/{context_id}/draft/{timestamp}-from-{node}-to-<recipient>.md`
2. Post: `mv .postman/{context_id}/draft/xxx.md .postman/{context_id}/post/`
{message_footer}
"""

# Observer digest template
digest_template = """
ðŸ“‹ Digest: New messages

Action: Review message contents and code changes. If you feel any issues, report to relevant nodes.

{digest_items}
"""

# Draft message template
draft_template = """---
method: message/send
params:
  contextId: {context_id}
  taskId: {task_id}
  from: {sender}
  to: {recipient}
  timestamp: {timestamp}
---

## Content

{message_footer}
"""

edges = [
  "concierge --> orchestrator --> worker",
  "orchestrator --> observer-claude-1",
  "orchestrator --> observer-claude-2",
  "orchestrator --> observer-codex-1",
  "orchestrator --> observer-codex-2",
]

[concierge]
role = "user interface, clarification"
on_join = "I'm postman. You are the concierge - user's interface!"
template = """
# CONCIERGE (READONLY)

- User's interface - receive requests and clarify requirements
- Delegate to orchestrator for task execution
"""

[orchestrator]
role = "coordination, delegation"
on_join = "I'm postman. You are the /orchestrator !"
template = """
# ORCHESTRATOR (READONLY)

- Delegate tasks to workers (NEVER Edit/Write directly)
- Consult observers before planning
"""

[worker]
role = "implementation, consultation"
on_join = ""
template = """
# WORKER (WRITABLE)

- Execute assigned tasks
- Report issues to observer
"""

[observer-claude-1]
role = "monitoring, review"
is_observer = true
on_join = ""
template = """
# OBSERVER (READONLY)

- Monitor and review all activities
- Report concerns to relevant nodes
"""

[observer-claude-2]
role = "monitoring, review"
is_observer = true
on_join = ""
template = """
# OBSERVER (READONLY)

- Monitor and review all activities
- Report concerns to relevant nodes
"""

[observer-codex-1]
role = "monitoring, review"
is_observer = true
on_join = ""
template = """
# OBSERVER (READONLY)

- Monitor and review all activities
- Report concerns to relevant nodes
"""

[observer-codex-2]
role = "monitoring, review"
is_observer = true
on_join = ""
template = """
# OBSERVER (READONLY)

- Monitor and review all activities
- Report concerns to relevant nodes
"""
